<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e293b">
    <title>–£—á—ë—Ç –∏–∑–¥–µ–ª–∏–π</title>
    <link rel="manifest" href="./manifest.json">
            <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–µ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #1e293b;
            font-size: 16px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        /* AUTH & INPUT CARDS */
        .auth-container, .input-section, .user-info {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .auth-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px; /* –í–∞–∂–Ω–æ –¥–ª—è iOS, —á—Ç–æ–±—ã –Ω–µ –∑—É–º–∏–ª */
            outline: none;
            transition: all 0.3s;
        }

        input:focus {
            border-color: #667eea;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
        }

        .btn-danger {
            background: #ef4444;
        }

        /* MAIN SCREEN LAYOUT (Flexbox Magic) */
        #mainScreen {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: calc(100vh - 70px); /* –í—ã—Å–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞ –º–∏–Ω—É—Å —Ö–µ–¥–µ—Ä */
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª —É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
        }

        .user-email {
            color: #64748b;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* SCROLLABLE LIST */
        .products-wrapper {
            flex: 1;
            overflow-y: auto; /* –°–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å */
            padding-bottom: 20px;
            -webkit-overflow-scrolling: touch; /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ iOS */
        }

        .products-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 5px; /* –ß—É—Ç—å –≤–æ–∑–¥—É—Ö–∞ –ø–æ –±–æ–∫–∞–º */
        }

        .product-item {
            background: white;
            border-radius: 12px;
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .product-item:active {
            background-color: #f8fafc;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            padding-right: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .product-count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .delete-product-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            flex-shrink: 0;
        }

        /* BOTTOM INPUT BAR */
        .input-section {
            margin-bottom: 0;
            padding: 15px;
            border-radius: 16px 16px 0 0; /* –ü–ª–æ—Å–∫–∏–π –Ω–∏–∑ –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ */
            flex-shrink: 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 20px;
            width: 95%;
            max-width: 500px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 80%;
        }

        .close-btn {
            background: #f1f5f9;
            color: #64748b;
            padding: 6px 14px;
            font-size: 13px;
        }

        .hint {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 6px;
            margin-bottom: 15px;
        }

        .numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
            min-height: 80px;
            overflow-y: auto;
            max-height: 40vh;
        }

        .number-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-number {
            background: rgba(255,255,255,0.25);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        /* STATES */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: white;
        }

        .loading {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
            text-align: center;
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
            text-align: center;
        }

        .auth-toggle {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #64748b;
        }

        .hidden {
            display: none !important;
        }
        </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ –£—á—ë—Ç –∏–∑–¥–µ–ª–∏–π</h1>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="loadingScreen" class="loading">
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="authScreen" class="hidden">
            <div class="auth-container">
                <div class="auth-title" id="authTitle">–í—Ö–æ–¥</div>
                <div id="authError"></div>
                <div id="authSuccess"></div>
                
                <input type="email" id="authEmail" class="input-full" placeholder="Email" autocomplete="email">
                <input type="password" id="authPassword" class="input-full" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
                
                <button id="authSubmitBtn" onclick="handleAuth()" style="width: 100%; margin-bottom: 12px;">–í–æ–π—Ç–∏</button>
                
                <div class="auth-toggle">
                    <span id="authToggleText">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
                    <a onclick="toggleAuthMode()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
            </div>
        </div>

                <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen" class="hidden">
            <!-- –ò–Ω—Ñ–∞ –æ —é–∑–µ—Ä–µ -->
            <div class="user-info">
                <div class="user-email" id="userEmail">user@example.com</div>
                <button class="logout-btn" onclick="handleLogout()">–í—ã–π—Ç–∏</button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞) -->
            <div class="products-wrapper">
                <div class="products-list" id="productsList">
                    <!-- –°—é–¥–∞ JS –ø–∏—Ö–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã -->
                </div>
                
                <div class="empty-state hidden" id="emptyState">
                    <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ –∏–∑–¥–µ–ª–∏–µ</p>
                </div>
            </div>

            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ (–¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–Ω–∏–∑—É) -->
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="productInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –•–¢04)" autocomplete="off">
                    <button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle"></div>
                    <button class="close-btn" onclick="closeModal()">–ù–∞–∑–∞–¥</button>
                </div>
                
                <div class="input-group">
                    <input type="text" id="numberInput" placeholder="–ù–æ–º–µ—Ä –∏–∑–¥–µ–ª–∏—è">
                    <button onclick="addNumber()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <p class="hint">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö: 55, 56, 57 –∏–ª–∏ 55-60</p>
                
                <div class="numbers-list" id="numbersList"></div>
            </div>
        </div>
    </div>

    <script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

// Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const SUPABASE_URL = 'https://ntsdwbrdxnexgjjekfqk.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50c2R3YnJkeG5leGdqamVrZnFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MjQ0MDYsImV4cCI6MjA4NDIwMDQwNn0.5ZrQNwFD-m4Rq4lKzfhPEGbw8BXhIoYViC-nJORosyQ';

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser = null;
let products = [];
let currentProductId = null;
let isLoginMode = true;
let realtimeChannel = null;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
async function init() {
    const { data: { user } } = await supabase.auth.getUser();
    
    if (user) {
        currentUser = user;
        showMainScreen();
        await loadProducts();
    } else {
        showAuthScreen();
    }
    
    document.getElementById('loadingScreen').classList.add('hidden');
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
supabase.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN') {
        currentUser = session.user;
        showMainScreen();
        loadProducts();
    } else if (event === 'SIGNED_OUT') {
        currentUser = null;
        products = [];
        showAuthScreen();
    }
});

function showAuthScreen() {
    document.getElementById('authScreen').classList.remove('hidden');
    document.getElementById('mainScreen').classList.add('hidden');
}

function showMainScreen() {
    document.getElementById('authScreen').classList.add('hidden');
    document.getElementById('mainScreen').classList.remove('hidden');
    document.getElementById('userEmail').textContent = currentUser.email;
    setupRealtime();
}

window.toggleAuthMode = function() {
    isLoginMode = !isLoginMode;
    const title = document.getElementById('authTitle');
    const btn = document.getElementById('authSubmitBtn');
    const toggleText = document.getElementById('authToggleText');
    
    if (isLoginMode) {
        title.textContent = '–í—Ö–æ–¥';
        btn.textContent = '–í–æ–π—Ç–∏';
        toggleText.textContent = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?';
    } else {
        title.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
        btn.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
        toggleText.textContent = '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?';
    }
    
    document.getElementById('authError').innerHTML = '';
    document.getElementById('authSuccess').innerHTML = '';
};

window.handleAuth = async function() {
    const email = document.getElementById('authEmail').value.trim();
    const password = document.getElementById('authPassword').value;
    const errorDiv = document.getElementById('authError');
    const successDiv = document.getElementById('authSuccess');
    
    errorDiv.innerHTML = '';
    successDiv.innerHTML = '';
    
    if (!email || !password) {
        errorDiv.innerHTML = '<div class="error-message">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è</div>';
        return;
    }

    const btn = document.getElementById('authSubmitBtn');
    btn.disabled = true;
    btn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

    try {
        if (isLoginMode) {
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
        } else {
            const { error } = await supabase.auth.signUp({ email, password });
            if (error) throw error;
            successDiv.innerHTML = '<div class="success-message">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</div>';
        }
    } catch (error) {
        errorDiv.innerHTML = `<div class="error-message">${error.message}</div>`;
        btn.disabled = false;
        btn.textContent = isLoginMode ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
    }
};

window.handleLogout = async function() {
    await supabase.auth.signOut();
};

async function loadProducts() {
    const { data, error } = await supabase
        .from('products')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Error loading products:', error);
        return;
    }

    products = data || [];
    renderProducts();
}

async function cleanOldProducts() {
    const twoMonthsAgo = Date.now() - (60 * 24 * 60 * 60 * 1000);
    const oldProducts = products.filter(p => new Date(p.last_update).getTime() < twoMonthsAgo);
    
    for (const product of oldProducts) {
        await supabase.from('products').delete().eq('id', product.id);
    }
    
    products = products.filter(p => new Date(p.last_update).getTime() >= twoMonthsAgo);
}

window.addProduct = async function() {
    const input = document.getElementById('productInput');
    const name = input.value.trim();
    
    if (!name) return;

    const { data, error } = await supabase
        .from('products')
        .insert({
            user_id: currentUser.id,
            name: name,
            numbers: [],
            last_update: new Date().toISOString()
        })
        .select()
        .single();

    if (error) {
        console.error('Error adding product:', error);
        return;
    }

    products.unshift(data);
    input.value = '';
    renderProducts();
};

function renderProducts() {
    const list = document.getElementById('productsList');
    const empty = document.getElementById('emptyState');

    if (products.length === 0) {
        list.innerHTML = '';
        empty.classList.remove('hidden');
        return;
    }

    list.innerHTML = products.map(p => `
    <div class="product-item" onclick="openModal(${p.id})">
        <div class="product-name">${p.name}</div>
        <div style="display: flex; align-items: center;">
            <div class="product-count">${p.numbers.length} —à—Ç</div>
            <button class="delete-product-btn" onclick="deleteProduct(event, ${p.id})">üóëÔ∏è</button>
        </div>
    </div>
`).join('');
}

window.openModal = function(productId) {
    currentProductId = productId;
    const product = products.find(p => p.id === productId);
    
    if (!product) {
        console.error('–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', productId);
        return;
    }
    
    document.getElementById('modalTitle').textContent = product.name;
    document.getElementById('modal').style.display = 'block';
    renderNumbers();
};

window.closeModal = function() {
    document.getElementById('modal').style.display = 'none';
    document.getElementById('numberInput').value = '';
    currentProductId = null;
};

window.addNumber = async function() {
    const input = document.getElementById('numberInput');
    const value = input.value.trim();
    
    if (!value || !currentProductId) return;

    const product = products.find(p => p.id === currentProductId);
    const newNumbers = parseNumbers(value);
    const updatedNumbers = [...product.numbers, ...newNumbers];

    const { error } = await supabase
        .from('products')
        .update({ 
            numbers: updatedNumbers,
            last_update: new Date().toISOString()
        })
        .eq('id', currentProductId);

    if (error) {
        console.error('Error adding number:', error);
        return;
    }

    product.numbers = updatedNumbers;
    product.last_update = new Date().toISOString();
    
    input.value = '';
    renderNumbers();
    renderProducts();
};

function parseNumbers(input) {
    const numbers = [];
    const parts = input.split(',').map(s => s.trim());
    
    parts.forEach(part => {
        if (part.includes('-')) {
            const [start, end] = part.split('-').map(s => parseInt(s.trim()));
            if (!isNaN(start) && !isNaN(end) && start <= end) {
                for (let i = start; i <= end; i++) {
                    numbers.push(i.toString());
                }
            }
        } else if (part) {
            numbers.push(part);
        }
    });
    
    return numbers;
}

window.removeNumber = async function(numIndex) {
    const product = products.find(p => p.id === currentProductId);
    const updatedNumbers = product.numbers.filter((_, i) => i !== numIndex);

    const { error } = await supabase
        .from('products')
        .update({ 
            numbers: updatedNumbers,
            last_update: new Date().toISOString()
        })
        .eq('id', currentProductId);

    if (error) {
        console.error('Error removing number:', error);
        return;
    }

    product.numbers = updatedNumbers;
    product.last_update = new Date().toISOString();
    
    renderNumbers();
    renderProducts();
};

window.deleteProduct = async function(event, productId) {
    event.stopPropagation(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–ø–ª—ã—Ç–∏–µ (–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥–∞–ª–∫—É)
    
    if (!confirm('‚ùì –¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ?')) return;

    const { error } = await supabase
        .from('products')
        .delete()
        .eq('id', productId)
        .eq('user_id', currentUser.id); // –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

    if (error) {
        console.error('Error deleting product:', error);
        return;
    }

    // –£–¥–∞–ª—è–µ–º –∏–∑ local state
    products = products.filter(p => p.id !== productId);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
    renderProducts();
};

function renderNumbers() {
    const list = document.getElementById('numbersList');
    const product = products.find(p => p.id === currentProductId);
    
    if (!product || product.numbers.length === 0) {
        list.innerHTML = '<p style="color: #94a3b8; text-align: center; width: 100%;">–ù–æ–º–µ—Ä–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        return;
    }

    list.innerHTML = product.numbers.map((num, i) => `
        <div class="number-tag">
            ${num}
            <button class="remove-number" onclick="removeNumber(${i})">√ó</button>
        </div>
    `).join('');
}

// Event listeners
document.getElementById('productInput')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') addProduct();
});

document.getElementById('numberInput')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') addNumber();
});

document.getElementById('authEmail')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleAuth();
});

document.getElementById('authPassword')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleAuth();
});

// Service Worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
}

// Realtime setup
function setupRealtime() {
    if (!currentUser) return;
    
    if (realtimeChannel) {
        supabase.removeChannel(realtimeChannel);
    }

    console.log('üîå –ü–æ–¥–∫–ª—é—á–∞—é —Ä–µ–∞–ª—Ç–∞–π–º –¥–ª—è user:', currentUser.id);

    realtimeChannel = supabase
        .channel('products-changes')
        .on('postgres_changes', 
            { event: '*', schema: 'public', table: 'products', filter: `user_id=eq.${currentUser.id}` },
            (payload) => {
                console.log('üì° Realtime —Å–æ–±—ã—Ç–∏–µ:', payload);
                loadProducts();
            }
        )
        .subscribe(status => {
            console.log('üì∂ –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:', status);
        });
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
window.addProduct = addProduct;
window.addNumber = addNumber;
window.removeNumber = removeNumber;
window.openModal = openModal;
window.closeModal = closeModal;
window.handleAuth = handleAuth;
window.handleLogout = handleLogout;
window.toggleAuthMode = toggleAuthMode;

// –ó–∞–ø—É—Å–∫
init();
</script>
</html>
